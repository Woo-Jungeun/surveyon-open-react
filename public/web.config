<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
    <rewrite>
      <rules>
        <!-- 1. API 프록시 규칙: /api/로 시작하는 요청을 외부 서버로 전달 -->
        <rule name="API Proxy" stopProcessing="true">
          <match url="^api/(.*)" />
          <action type="Rewrite" url="https://hpropublic.hrcglobal.com/api/{R:1}" />
          <serverVariables>
            <set name="HTTP_APIKEY" value="xDhxuxOyYA11l8GOKT1D7ixLMM5nriduk3Wx8j7YadswCPii8P35DMEQE9i7ALElIQaM/DT9OELQM3oYx+MatQLiRYU1hlFM+b0k9t/+hbc=" />
          </serverVariables>
        </rule>

        <!-- 2. 리액트 라우팅: 파일/디렉터리/자원/백엔드 API가 아니면 index.html로 리라이트 -->
        <rule name="React SPA Routes" stopProcessing="true">
          <match url=".*" />
          <conditions logicalGrouping="MatchAll">
            <!-- 실제 파일/디렉터리는 패스 -->
            <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
            <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" />

            <!-- API, Swagger, SignalR 등 서버 라우트는 패스 (api 추가됨) -->
            <add input="{REQUEST_URI}" pattern="^/(Scripts|assets|signalr|APIx|api)/" negate="true" />
            <add input="{REQUEST_URI}" pattern="^/APIx/signalr/" negate="true" />

            <!-- 정적 리소스는 패스 -->
            <add input="{REQUEST_URI}" pattern="\.(css|js|map|png|jpg|jpeg|gif|svg|ico|json|txt|woff|woff2|ttf|eot|webp)$" negate="true" />
          </conditions>
          <!-- 나머지는 전부 index.html -->
          <action type="Rewrite" url="/index.html" />
        </rule>
      </rules>
    </rewrite>
  </system.webServer>
</configuration>
